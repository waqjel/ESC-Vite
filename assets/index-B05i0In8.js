(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function o(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=o(n);fetch(n.href,i)}})();async function T(){const e=await fetch("https://lernia-sjj-assignments.vercel.app/api/challenges",{headers:{Accept:"application/json"}});if(!e.ok)throw new Error(e.status+" Could not load challenges "+e.statusText);return(await e.json()).challenges}async function S(e,t){const o=await fetch(`https://lernia-sjj-assignments.vercel.app/api/booking/available-times?date=${e}&challenge=${t}`);if(!o.ok)throw new Error(o.status+" Could not fetch available times "+o.statusText);return await o.json()}async function k(e){try{const o=await(await fetch("https://lernia-sjj-assignments.vercel.app/api/booking/reservations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({challenge:parseInt(e.challengeId),name:e.fullName,email:e.email,date:e.date,time:e.time,participants:parseInt(e.participants)})})).json();console.log(o)}catch(t){console.error("Booking failed:",t)}}const p={challengeId:null,challengeTitle:null,date:null,fullName:null,email:null,tel:null,time:null,participants:null};async function C(e,t,o){try{const r=await S(e,o);t.innerHTML="",r.slots.forEach(n=>{const i=document.createElement("option");i.value=n,i.textContent=n,t.appendChild(i)})}catch(r){t.innerHTML="";const n=document.createElement("option");n.value="",n.textContent="Error loading time slots",n.className="error",t.appendChild(n),console.error("Error fetching time slots:",r)}}async function w(e,t,o){const r=document.querySelector("#date");if(e==="modal1"&&(!r||!r.value)){alert("Please select a date");return}p.date=r.value;const n=document.querySelector("#time");if(n&&C(p.date,n,o),e==="modal2"){const f=document.querySelector("#name"),d=document.querySelector("#email"),u=document.querySelector("#tel"),a=document.querySelector("#time"),c=document.querySelector("#participants");if(!f||!f.value){alert("Please enter your name");return}if(!d||!d.value){alert("Please enter your email");return}if(!/^\d{10}$/.test(String(u.value))){alert("Please enter a valid 10-digit telephone number");return}if(!a||!a.value){alert("Please select a time");return}if(!c||!c.value){alert("Please enter number of participants");return}p.fullName=f.value,p.email=d.value,p.tel=u.value,p.time=a.value,p.participants=c.value}const i=document.getElementById(e),s=document.getElementById(t);i&&(i.style.visibility="hidden",i.style.opacity="0"),s&&(s.style.visibility="visible",s.style.opacity="1"),t==="modal3"&&(k(p),document.querySelector(".back-link").addEventListener("click",function(){window.location.href="OurChallenges.html"}))}async function x(e,t){const o=e.target.closest(".BookThisRoom");if(o){e.preventDefault();try{p.challengeId=o.dataset.id;const r=await fetch("bookThisRoomModal.html");if(!r.ok)throw new Error("Page not found");const n=await r.text();if(!t){console.error("Modal container not found");return}t.innerHTML=n,t.classList.remove("show"),t.offsetWidth,t.classList.add("show");const i=document.getElementById("modal1");if(i){i.style.opacity="1",i.style.visibility="visible";const a=i.querySelector("#date");a&&(a.min=new Date().toISOString().split("T")[0]);const c=i.querySelector("#participants");c&&(c.min=1,c.value=1);const y=t.querySelectorAll(".bookedRoom-title");if(y.length>0)try{const l=(await T()).find(m=>m.id===parseInt(p.challengeId));y.forEach(m=>{const v=m.closest(".modal");v&&v.id=="modal1"?l.type=="onsite"?m.innerHTML=`Book room "${l.title}" (step 1)`:m.innerHTML=`Take challenge online "${l.title}" (step 1)`:v&&v.id=="modal2"&&(l.type=="onsite"?m.innerHTML=`Book room "${l.title}" (step 2)`:m.innerHTML=`Take challenge online "${l.title}" (step 2)`)});const h=t.querySelector("#participants");if(h&&l){const m=l.minParticipants,v=l.maxParticipants;h.min=m,h.max=v,h.value=m,h.addEventListener("input",()=>{h.value>v&&(h.value=v),h.value<m&&(h.value=m)})}p.challengeTitle=l}catch(g){console.error("Error fetching challenge title:",g)}}else{console.error("Modal1 not found in loaded HTML");return}t.querySelectorAll(".close").forEach(a=>{a.addEventListener("click",function(){t.classList.remove("show"),setTimeout(()=>{t.innerHTML=""},300)})}),t.querySelectorAll(".next-btn").forEach(a=>{a.addEventListener("click",function(){const c=this.dataset.next,y=this.closest(".modal").id;w(y,c,p.challengeId)})});const d=document.getElementById("bookingForm");d&&d.addEventListener("submit",function(a){a.preventDefault()});const u=document.getElementById("bookingForm2");u&&u.addEventListener("submit",function(a){a.preventDefault(),t.style.visibility="hidden",t.style.opacity="0"})}catch(r){console.error("Error loading Modal:",r),t&&(t.innerHTML="<p>Error loading booking form. Please try again.</p>",t.style.visibility="visible",t.style.opacity="1")}}}document.querySelector(".logo");const B=document.querySelectorAll(".buttons"),I=document.querySelector("#menuBtn"),E=document.querySelector("#mainNav"),M=document.querySelector("#closeBtn"),b=document.querySelector("#overlay");document.querySelector(".filterBtn");document.querySelector("#storyBtn");I.addEventListener("click",function(){E.classList.add("active"),b.classList.add("active")});M.addEventListener("click",function(){E.classList.remove("active"),b.classList.remove("active")});B.forEach(e=>{const t=e.children;for(let o=0;o<t.length;o++)t[o].addEventListener("click",()=>{window.location.href="OurChallenges.html"})});document.addEventListener("DOMContentLoaded",function(){let e=document.querySelector("#BookRoomModal");e||(e=document.createElement("div"),e.id="bookRoomModal",e.className="modal",document.body.appendChild(e)),document.addEventListener("click",t=>x(t,e))});(function(){const e=sessionStorage.getItem("redirect");if(e){sessionStorage.removeItem("redirect");const t=e.replace(/^\/[^/]+\//,"/");t&&t!=="/"&&t!=="/index.html"&&(t.includes("OurChallenges.html")?window.location.href="./OurChallenges.html":t.includes("theStory.html")?window.location.href="./theStory.html":t.includes("contact.html")&&(window.location.href="./contact.html"))}})();function q(e,t){if(!t)return;const o=document.createElement("article"),r=document.createElement("img"),n=document.createElement("div"),i=document.createElement("h3"),s=document.createElement("div"),f=document.createElement("span"),d=document.createElement("p"),u=document.createElement("button"),a=document.createElement("span");o.classList.add("card"),r.src=e.image,n.classList.add("cardContent"),i.innerText=e.title,s.classList.add("rating"),a.classList.add("cardTypeIcon"),f.classList.add("participants");let c=e.minParticipants,y=e.maxParticipants;if(f.innerText=c===y?c+" participants":c+"-"+y+" participants",e.description.length>50){if(e.description[50]==" ")d.innerText=e.description.substring(0,51);else{const g=e.description.substring(0,51).lastIndexOf(" ");d.innerText=e.description.substring(0,g)}d.innerText+="..."}else d.innerText=e.description;u.classList.add("BookThisRoom","bookBtn"),u.dataset.id=e.id,u.innerText="Book this room";for(let g=0;g<5;g++){const l=document.createElement("span");l.classList.add(g<e.rating?"fa-solid":"fa-regular","fa-star"),s.appendChild(l)}t.appendChild(o),o.appendChild(r),o.appendChild(n),o.appendChild(a),n.appendChild(i),s.appendChild(f),n.appendChild(s),n.appendChild(d),n.appendChild(u),requestAnimationFrame(()=>{o.classList.add("show")}),e.type==="online"?(f.innerText+=" (networked)",a.classList.add("fa-solid","fa-display"),u.innerText="Take challenge online"):(i.innerText+=" (on-site)",a.classList.add("fa-solid","fa-house"),u.innerText="Book this room")}function L(e,t){if(!e)return;if(e.innerHTML="",!t.length){e.innerHTML="<p>No challenges found.</p>";return}const o=document.createElement("div");o.classList.add("modal"),o.id="bookRoomModal",e.appendChild(o),t.forEach(r=>{q(r,e)})}document.addEventListener("DOMContentLoaded",async()=>{const e=document.getElementById("popularChallenges"),t=document.getElementById("allChallenges");e&&(e.innerHTML="<p>Loading…</p>"),t&&(t.innerHTML="<p>Loading…</p>");try{const o=await T();if(e){const r=[...o].sort((n,i)=>(i.rating??0)-(n.rating??0)).slice(0,3);L(e,r)}t&&L(t,o)}catch(o){console.error(o);const r="Could not fetch data. "+o.message;e&&(e.innerHTML='<p class="error">'+r+"</p>"),t&&(t.innerHTML='<p class="error">'+r+"</p>")}});
