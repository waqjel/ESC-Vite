(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const m of o.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&r(m)}).observe(document,{childList:!0,subtree:!0});function i(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=i(n);fetch(n.href,o)}})();async function E(){const t=await fetch("https://lernia-sjj-assignments.vercel.app/api/challenges",{headers:{Accept:"application/json"}});if(!t.ok)throw new Error(t.status+" Could not load challenges "+t.statusText);return(await t.json()).challenges}async function S(t,e){const i=await fetch(`https://lernia-sjj-assignments.vercel.app/api/booking/available-times?date=${t}&challenge=${e}`);if(!i.ok)throw new Error(i.status+" Could not fetch available times "+i.statusText);return await i.json()}async function T(t){try{const i=await(await fetch("https://lernia-sjj-assignments.vercel.app/api/booking/reservations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({challenge:parseInt(t.challengeId),name:t.fullName,email:t.email,date:t.date,time:t.time,participants:parseInt(t.participants)})})).json();console.log(i)}catch(e){console.error("Booking failed:",e)}}const s={challengeId:null,challengeTitle:null,date:null,fullName:null,email:null,tel:null,time:null,participants:null};async function k(t,e,i){try{const r=await S(t,i);e.innerHTML="",r.slots.forEach(n=>{const o=document.createElement("option");o.value=n,o.textContent=n,e.appendChild(o)})}catch(r){e.innerHTML="";const n=document.createElement("option");n.value="",n.textContent="Error loading time slots",n.className="error",e.appendChild(n),console.error("Error fetching time slots:",r)}}async function w(t,e,i){const r=document.querySelector("#date");if(t==="modal1"&&(!r||!r.value)){alert("Please select a date");return}s.date=r.value;const n=document.querySelector("#time");if(n&&k(s.date,n,i),t==="modal2"){const y=document.querySelector("#name"),p=document.querySelector("#email"),h=document.querySelector("#tel"),l=document.querySelector("#time"),u=document.querySelector("#participants");if(!y||!y.value){alert("Please enter your name");return}if(!p||!p.value){alert("Please enter your email");return}if(!/^\d{10}$/.test(String(h.value))){alert("Please enter a valid 10-digit telephone number");return}if(!l||!l.value){alert("Please select a time");return}if(!u||!u.value){alert("Please enter number of participants");return}s.fullName=y.value,s.email=p.value,s.tel=h.value,s.time=l.value,s.participants=u.value}const o=document.getElementById(t),m=document.getElementById(e);o&&(o.style.visibility="hidden",o.style.opacity="0"),m&&(m.style.visibility="visible",m.style.opacity="1"),e==="modal3"&&(T(s),document.querySelector(".back-link").addEventListener("click",function(){window.location.href="OurChallenges.html"}))}async function q(t,e){const i=t.target.closest(".BookThisRoom");if(i){t.preventDefault();try{s.challengeId=i.dataset.id;const r=await fetch("bookThisRoomModal.html");if(!r.ok)throw new Error("Page not found");const n=await r.text();if(!e){console.error("Modal container not found");return}e.innerHTML=n,e.classList.remove("show"),e.offsetWidth,e.classList.add("show");const o=document.getElementById("modal1");if(o){o.style.opacity="1",o.style.visibility="visible";const l=o.querySelector("#date");l&&(l.min=new Date().toISOString().split("T")[0]);const u=o.querySelector("#participants");u&&(u.min=1,u.value=1);const v=e.querySelectorAll(".bookedRoom-title");if(v.length>0)try{const c=(await E()).find(a=>a.id===parseInt(s.challengeId));v.forEach(a=>{const f=a.closest(".modal");f&&f.id=="modal1"?c.type=="onsite"?a.innerHTML=`Book room "${c.title}" (step 1)`:a.innerHTML=`Take challenge online "${c.title}" (step 1)`:f&&f.id=="modal2"&&(c.type=="onsite"?a.innerHTML=`Book room "${c.title}" (step 2)`:a.innerHTML=`Take challenge online "${c.title}" (step 2)`)});const d=e.querySelector("#participants");if(d&&c){const a=c.minParticipants,f=c.maxParticipants;d.min=a,d.max=f,d.value=a,d.addEventListener("input",()=>{d.value>f&&(d.value=f),d.value<a&&(d.value=a)})}s.challengeTitle=c}catch(g){console.error("Error fetching challenge title:",g)}}else{console.error("Modal1 not found in loaded HTML");return}e.querySelectorAll(".close").forEach(l=>{l.addEventListener("click",function(){e.classList.remove("show"),setTimeout(()=>{e.innerHTML=""},300)})}),e.querySelectorAll(".next-btn").forEach(l=>{l.addEventListener("click",function(){const u=this.dataset.next,v=this.closest(".modal").id;w(v,u,s.challengeId)})});const p=document.getElementById("bookingForm");p&&p.addEventListener("submit",function(l){l.preventDefault()});const h=document.getElementById("bookingForm2");h&&h.addEventListener("submit",function(l){l.preventDefault(),e.style.visibility="hidden",e.style.opacity="0"})}catch(r){console.error("Error loading Modal:",r),e&&(e.innerHTML="<p>Error loading booking form. Please try again.</p>",e.style.visibility="visible",e.style.opacity="1")}}}document.querySelector(".logo");const B=document.querySelectorAll(".buttons"),M=document.querySelector("#menuBtn"),L=document.querySelector("#mainNav"),I=document.querySelector("#closeBtn"),b=document.querySelector("#overlay");document.querySelector(".filterBtn");document.querySelector("#storyBtn");M.addEventListener("click",function(){L.classList.add("active"),b.classList.add("active")});I.addEventListener("click",function(){L.classList.remove("active"),b.classList.remove("active")});B.forEach(t=>{const e=t.children;for(let i=0;i<e.length;i++)e[i].addEventListener("click",()=>{window.location.href="OurChallenges.html"})});document.addEventListener("DOMContentLoaded",function(){let t=document.querySelector("#BookRoomModal");t||(t=document.createElement("div"),t.id="bookRoomModal",t.className="modal",document.body.appendChild(t)),document.addEventListener("click",e=>q(e,t))});export{E as f};
